<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Мапа усвідомлення — Тест (V2, покроковий) | Я є</title>

<meta name="description" content="Розширений покроковий тест мислення (42 питання): відповіді по одному екрану, без повернення назад. Чесна позначка, де ти є." />
<meta name="robots" content="index, follow" />
<meta name="keywords" content="самопізнання, архетипи, психологія, внутрішній ріст, self-discovery, archetypes, psychology, personal growth" />

<!-- Open Graph -->
<meta property="og:title" content="Мапа усвідомлення — Тест (V2, покроковий) | Я є" />
<meta property="og:description" content="Розширений покроковий тест мислення (42 питання): відповіді по одному екрану, без повернення назад. Чесна позначка, де ти є." />
<meta property="og:type" content="website" />
<meta property="og:image" content="images/ya-e-og.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content="uk_UA" />

<link rel="canonical" href="/map-awareness-test-v2.html" />

<link rel="icon" href="images/favicon-v2.png" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Lora&display=swap" rel="stylesheet" />


  <style>
    :root {
      --primary: #4b0082;
      --secondary: #800080;
      --button-bg: #4c1d95;
      --button-hover: #5b21b6;
      --gray-50: #f9fafb;
      --white: #ffffff;
      --accent: #ffd700;

      --ink:#111;
      --muted:#6b7280;
      --bg:#ffffff;
      --panel:#f8fafc;
      --btn:#4c1d95;
      --btn2:#5b21b6;
      --ok:#10b981;
      --warn:#f59e0b;
      --err:#ef4444;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Lora', serif;
      color: var(--ink);
      background: var(--bg);
      display: flex;
      flex-direction: column;
    }

    /* Skip-link */
    .skip-link {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus {
      left: 1rem;
      top: 1rem;
      width: auto;
      height: auto;
      background:#000;
      color:#fff;
      padding:.5rem .75rem;
      border-radius:6px;
      z-index: 1000;
    }

    /* Header / nav */
    nav {
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: var(--white);
    }
    .nav-wrap {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      gap: 1rem;
    }
    .logo {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      color: var(--white);
      text-decoration: none;
      font-weight: 700;
      font-size: 1.5rem;
    }
    .logo img { width: 32px; height: 32px; }

    .menu-toggle {
      display: none;
      background: none;
      border: 0;
      color: var(--white);
      font-size: 1.5rem;
      cursor: pointer;
    }
    #primary-nav {
      list-style: none;
      display: flex;
      gap: 1rem;
      margin: 0;
      padding: 0;
    }
    #primary-nav a {
      color: var(--white);
      text-decoration: none;
      padding: .5rem;
      display: block;
      font-size: .95rem;
      transition: color .2s ease, transform .2s ease;
    }
    #primary-nav a:hover,
    #primary-nav a:focus {
      color: var(--accent);
      transform: scale(1.05);
    }
    #primary-nav a.active {
      color: var(--accent);
      text-decoration: underline;
    }

    .lang-toggle {
      background:#fff;
      color:#000;
      border:2px solid #f00;
      border-radius:9999px;
      padding:.5rem 1rem;
      font-weight:700;
      cursor:pointer;
      transition: transform .2s ease, background .2s ease;
    }
    .lang-toggle:hover,
    .lang-toggle:focus {
      background:#e0e0e0;
      transform: scale(1.05);
    }

    @media (max-width: 768px) {
      .menu-toggle { display: inline-block; }
      .nav-wrap { flex-wrap: wrap; }
      #primary-nav {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: linear-gradient(to right, var(--primary), var(--secondary));
        padding: 1rem;
        box-shadow: 0 4px 8px rgba(0,0,0,.2);
        flex-direction: column;
        gap: .5rem;
      }
      #primary-nav.active { display: flex; }
    }

    /* Utilities */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
    .text-center { text-align: center; }
    .py-20 { padding: 5rem 0; }
    .py-16 { padding: 4rem 0; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mt-6 { margin-top: 1.5rem; }
    .text-3xl { font-size: 1.875rem; }
    .font-bold { font-weight: 700; }
    .font-lora { font-family: 'Lora', serif; }

    footer {
      margin-top: auto;
      background: var(--primary);
      color: var(--white);
      text-align: center;
      padding: 1.5rem 1rem;
    }
    footer a { color: var(--accent); text-decoration: underline; }

    :focus-visible {
      outline:2px dashed var(--accent);
      outline-offset: 3px;
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none!important; transition:none!important; }
    }

    /* ---- Test layout ---- */
    header.test-header{
      background:linear-gradient(90deg,var(--primary),var(--secondary));
      color:#fff;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:1rem;}
    .test-header-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.75rem;
    }
    .test-header h1{font-size:2rem; margin:.25rem 0;}
    .test-header p.lead{margin:.25rem 0 0; opacity:.9;}

    main#main{padding-bottom:2rem;}

    .grid{display:grid; gap:1rem;}
    @media(min-width:960px){
      .grid{grid-template-columns:380px 1fr;}
    }
    .card{
      background:var(--panel);
      border-radius:16px;
      padding:1rem;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
    }
    .controls{display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;}
    .btn,button{
      background:var(--btn);
      color:#fff;
      border:0;
      border-radius:9999px;
      padding:.6rem 1rem;
      cursor:pointer;
    }
    button:hover,.btn:hover{background:var(--btn2);}
    .ghost{background:transparent; border:2px solid #fff;}
    .muted{color:var(--muted);}
    .progress{
      height:10px;
      background:#e5e7eb;
      border-radius:999px;
      overflow:hidden;
      margin:.5rem 0 1rem;
    }
    .bar{
      height:100%;
      background:linear-gradient(90deg,var(--primary),var(--secondary));
      width:0%;
    }
    fieldset{border:0; padding:0; margin:0;}
    legend{font-weight:700; margin-bottom:.75rem;}
    label.opt{
      display:block;
      background:#fff;
      border-radius:12px;
      padding:.6rem .75rem;
      margin:.5rem 0;
      border:1px solid #e5e7eb;
      cursor:pointer;
    }
    input[type=radio]{margin-right:.5rem;}
    .navRow{display:flex; gap:.5rem; margin-top:.75rem; align-items:center;}
    .pill{
      display:inline-block;
      padding:.2rem .6rem;
      border-radius:999px;
      font-size:.8rem;
      background:#eee;
      margin-right:.25rem;
    }
    .result h2{margin-top:0;}

    /* ——— Spiral Viz ——— */
    .viz{display:flex; align-items:center; justify-content:center; padding:1rem;}
    svg{max-width:360px; width:100%; height:auto; overflow:visible;}
    .ring path{fill:none; stroke:#ddd; stroke-width:16; opacity:.7;}
    .ring path.active{stroke:url(#grad); opacity:1;}
    .pulse{animation:pulse 1.6s ease-in-out infinite;}
    @keyframes pulse{
      0%{filter:drop-shadow(0 0 0 rgba(75,0,130,.0))}
      50%{filter:drop-shadow(0 0 10px rgba(75,0,130,.35))}
      100%{filter:drop-shadow(0 0 0 rgba(75,0,130,.0))}
    }

    .tips{
      background:#fff;
      border:1px dashed #e5e7eb;
      border-radius:14px;
      padding:1rem;
    }
    .kicker{font-size:.9rem; letter-spacing:.06em; text-transform:uppercase; color:var(--muted);}
    .lvlname{font-weight:700;}
    .footer{margin-top:2rem; text-align:center; color:#666; font-size:.9rem;}
    .danger{background:#fff8f8; border:1px solid #ffe1e1; padding:.75rem; border-radius:12px;}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Перейти до основного вмісту</a>

  <nav role="navigation">
    <div class="nav-wrap">
      <a class="logo" href="index.html" aria-label="Перейти на головну сторінку / Go to homepage">
        <img src="images/favicon-v2.png" alt="Логотип Я є / I Am logo" width="32" height="32" decoding="async" />
        <span>
          <span class="lang-uk">Я є</span>
          <span class="lang-en" hidden>I Am</span>
        </span>
      </a>

      <button class="menu-toggle" aria-label="Переключити меню навігації / Toggle navigation menu" aria-expanded="false" aria-controls="primary-nav">☰</button>
      <button type="button" class="lang-toggle" aria-label="Переключити мову / Toggle language" aria-pressed="false">UA / EN</button>

      <ul id="primary-nav">
  <li><a href="index.html"><span class="lang-uk">Головна</span><span class="lang-en" hidden>Home</span></a></li>
  <li><a href="archetypes.html"><span class="lang-uk">Про архетипи</span><span class="lang-en" hidden>About Archetypes</span></a></li>
  <li><a href="about.html"><span class="lang-uk">Про мене</span><span class="lang-en" hidden>About Me</span></a></li>
  <li><a href="tools.html"><span class="lang-uk">Інструменти</span><span class="lang-en" hidden>Tools</span></a></li>
  <li><a href="map-awareness-test-v2.html"><span class="lang-uk">Мапа усвідомлення — Тест V2</span><span class="lang-en" hidden>Map of Awareness — Test V2</span></a></li>
  <li><a href="mind-exploration.html"><span class="lang-uk">Мисленне Дослідження</span><span class="lang-en" hidden>Mental Exploration</span></a></li>
  <li><a href="unravel-anxiety.html"><span class="lang-uk">Розплутування Тривоги</span><span class="lang-en" hidden>Anxiety Knot Unraveler</span></a></li>
  <li><a href="blog.html"><span class="lang-uk">Як жити далі?</span><span class="lang-en" hidden>How to Live On?</span></a></li>
  <li><a href="humor.html"><span class="lang-uk">Гумор</span><span class="lang-en" hidden>Humor</span></a></li>
  <li><a href="price.html"><span class="lang-uk">Прайс</span><span class="lang-en" hidden>Pricing</span></a></li>
  <li><a href="contact.html"><span class="lang-uk">Контакти</span><span class="lang-en" hidden>Contact</span></a></li>
</ul>
    </div>
  </nav>

  <main id="main">
    <header class="test-header">
      <div class="wrap test-header-inner">
        <div>
          <h1>
            <span class="lang-uk">Мапа усвідомлення — Тест (V2, покроковий)</span>
            <span class="lang-en" hidden>Map of Awareness — Test (V2, step-by-step)</span>
          </h1>
          <p class="lead">
            <span class="lang-uk">42 питання. Відповідаєш по одному. <strong>Без повернення назад.</strong> Перша інтонація — твоя.</span>
            <span class="lang-en" hidden>42 questions. You answer one by one. <strong>No way back.</strong> The first intonation is yours.</span>
          </p>
        </div>
        <div class="controls">
          <button class="ghost" id="btnQuit" title="Почати заново / Start over" hidden>
            <span class="lang-uk">Скинути</span>
            <span class="lang-en" hidden>Reset</span>
          </button>
        </div>
      </div>
    </header>

    <div class="wrap grid">
      <!-- Left: Spiral + legend -->
      <aside class="card" id="vizPanel">
        <div class="viz">
          <svg viewBox="0 0 320 320" role="img" aria-label="Спіраль рівнів усвідомлення / Spiral of awareness levels">
            <defs>
              <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#4b0082"/>
                <stop offset="100%" stop-color="#800080"/>
              </linearGradient>
            </defs>
            <g class="ring" id="ring7"></g>
            <g class="ring" id="ring6"></g>
            <g class="ring" id="ring5"></g>
            <g class="ring" id="ring4"></g>
            <g class="ring" id="ring3"></g>
            <g class="ring" id="ring2"></g>
            <g class="ring" id="ring1"></g>
          </svg>
        </div>
        <div>
          <div class="kicker lang-uk">Рівні (фази одного процесу)</div>
          <div class="kicker lang-en" hidden>Levels (phases of one process)</div>

          <ul class="lang-uk" style="margin:.5rem 0 0; padding-left:1.1rem">
            <li><span class="pill">1.</span><span class="lvlname">Інстинктивний</span> — Реакція важливіша за роздуми.</li>
            <li><span class="pill">2.</span><span class="lvlname">Емоційно-соціальний</span> — Бути як усі. Оцінка інших — компас.</li>
            <li><span class="pill">3.</span><span class="lvlname">Раціональний/егоцентричний</span> — Логіка, користь, цілі.</li>
            <li><span class="pill">4.</span><span class="lvlname">Критичний/саморефлексивний</span> — Сумнів у власних переконаннях.</li>
            <li><span class="pill">5.</span><span class="lvlname">Екзистенційний</span> — Дія без гарантій, чесність понад комфорт.</li>
            <li><span class="pill">6.</span><span class="lvlname">Системний/метасвідомість</span> — Узгодженість із реальністю.</li>
            <li><span class="pill">7.</span><span class="lvlname">Тотальна присутність</span> — Спокійна очевидність подій.</li>
          </ul>

          <ul class="lang-en" hidden style="margin:.5rem 0 0; padding-left:1.1rem">
            <li><span class="pill">1.</span><span class="lvlname">Instinctive</span> — Reaction is more important than reflection.</li>
            <li><span class="pill">2.</span><span class="lvlname">Emotional / social</span> — To be like everyone else. Others’ opinion is the compass.</li>
            <li><span class="pill">3.</span><span class="lvlname">Rational / ego-centric</span> — Logic, benefit, goals.</li>
            <li><span class="pill">4.</span><span class="lvlname">Critical / self-reflective</span> — Doubt in one’s own beliefs.</li>
            <li><span class="pill">5.</span><span class="lvlname">Existential</span> — Action without guarantees, honesty over comfort.</li>
            <li><span class="pill">6.</span><span class="lvlname">Systemic / meta-awareness</span> — Alignment with reality.</li>
            <li><span class="pill">7.</span><span class="lvlname">Total presence</span> — Calm obviousness of what’s happening.</li>
          </ul>
        </div>
      </aside>

      <!-- Right: Runner / Result -->
      <section class="card" id="runner">
        <div id="stepPanel">
          <div class="progress"><div class="bar" id="bar" style="width:0%"></div></div>
          <fieldset>
            <legend id="qText">Почнемо.</legend>
            <div id="opts"></div>
            <div class="navRow">
              <span class="muted" id="hint">Обери варіант, щоб перейти далі.</span>
              <button id="btnNext" disabled>Далі</button>
            </div>
          </fieldset>
        </div>

        <div id="resultPanel" class="result" hidden>
          <h2>
            <span class="lang-uk">Результат</span>
            <span class="lang-en" hidden>Result</span>
          </h2>
          <p id="resSummary" class="lead"></p>
          <div id="resBadges" style="margin:.5rem 0 1rem"></div>
          <div class="viz" id="vizEcho"></div>

          <h3>
            <span class="lang-uk">Що з цим робити</span>
            <span class="lang-en" hidden>What to do with it</span>
          </h3>
          <div class="tips">
            <ul class="lang-uk" style="margin:.5rem 0; padding-left:1.1rem">
              <li><strong>Це не оцінка.</strong> Це позначка на мапі. Ти тут — зараз.</li>
              <li><strong>Не “підіймайся”.</strong> Рівні — не кар’єра. Це фази одного руху. Спостерігай, що відпадає само.</li>
              <li><strong>Дивись на “розкид”.</strong> 2-й і 3-й за силою рівні — твої тіні та інерція.</li>
              <li><strong>Перевір “позичену глибину”.</strong> Багато 6–7 при низьких 4–5 — читання замість бачення.</li>
            </ul>
            <ul class="lang-en" hidden style="margin:.5rem 0; padding-left:1.1rem">
              <li><strong>This is not a grade.</strong> It’s a mark on the map. You’re here — now.</li>
              <li><strong>Don’t “climb up”.</strong> Levels aren’t a career ladder. They’re phases of one movement. Watch what falls off by itself.</li>
              <li><strong>Look at the “spread”.</strong> Level 2 and 3 by strength — your inertia and shadows.</li>
              <li><strong>Check for “borrowed depth”.</strong> Many level 6–7 answers with low 4–5 — reading instead of seeing.</li>
            </ul>
          </div>

          <h3 style="margin-top:1.25rem">
            <span class="lang-uk">Детальний опис</span>
            <span class="lang-en" hidden>Detailed breakdown</span>
          </h3>
          <div id="resDetails"></div>

          <div class="footer">
            <button id="btnRetake" class="btn" style="margin:.5rem auto 0">
              <span class="lang-uk">Пройти ще раз</span>
              <span class="lang-en" hidden>Take again</span>
            </button>
            <button id="btnShare" class="btn" style="margin:.5rem auto 0" hidden>
              <span class="lang-uk">Поділитися</span>
              <span class="lang-en" hidden>Share</span>
            </button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p>
      <span class="lang-uk">© 2025 Я є. Усі права захищено.</span>
      <span class="lang-en" hidden>© 2025 I Am. All rights reserved.</span>
    </p>
  </footer>

  <noscript>
    <div class="container" style="padding:1rem;">
      <p>JavaScript вимкнено. Перемикання мов, тест і мобільне меню працюють лише з увімкненим JavaScript.</p>
    </div>
  </noscript>

  <script>
    // ——— Мовний модуль (такий самий принцип, як на головній), + хук для тесту ———
    (function(){
      const TEXT_UA = {
        title: 'Мапа усвідомлення — Тест (V2, покроковий) | Я є',
        desc:  'Розширений покроковий тест мислення (42 питання): відповіді по одному екрану, без повернення назад. Чесна позначка, де ти є.',
        ogLocale: 'uk_UA',
        toggle: 'UA / EN'
      };
      const TEXT_EN = {
        title: 'Map of Awareness — Test (V2, step-by-step) | I Am',
        desc:  'Extended step-by-step thinking test (42 questions): one answer per screen, no way back. An honest mark of where you are.',
        ogLocale: 'en_US',
        toggle: 'EN / UA'
      };

      function applyLang(lang){
        const isEN = (lang === 'en');
        document.documentElement.lang = lang;

        document.querySelectorAll('.lang-uk').forEach(el => el.hidden = isEN);
        document.querySelectorAll('.lang-en').forEach(el => el.hidden = !isEN);

        const cfg = isEN ? TEXT_EN : TEXT_UA;
        document.title = cfg.title;
        const mDesc = document.querySelector('meta[name="description"]');
        const ogTitle = document.querySelector('meta[property="og:title"]');
        const ogDesc  = document.querySelector('meta[property="og:description"]');
        const ogLoc   = document.querySelector('meta[property="og:locale"]');
        if (mDesc)  mDesc.content = cfg.desc;
        if (ogTitle) ogTitle.content = cfg.title;
        if (ogDesc)  ogDesc.content = cfg.desc;
        if (ogLoc)   ogLoc.content = cfg.ogLocale;

        const btn = document.querySelector('.lang-toggle');
        if (btn){
          btn.textContent = cfg.toggle;
          btn.setAttribute('aria-pressed', String(isEN));
        }

        localStorage.setItem('lang', lang);

        // дати знати тесту, що мова змінилася
        if (window.__onLangChange) {
          window.__onLangChange(lang);
        }
      }

      function initLang(){
        const saved = localStorage.getItem('lang');
        const prefer = saved || 'uk';
        applyLang(prefer);
      }

      window.__lang = { applyLang };

      document.addEventListener('DOMContentLoaded', initLang);

      document.addEventListener('DOMContentLoaded', function(){
        const btn = document.querySelector('.lang-toggle');
        if (!btn) return;
        btn.addEventListener('click', function(e){
          e.preventDefault();
          const cur = document.documentElement.lang || 'uk';
          const next = (cur === 'uk') ? 'en' : 'uk';
          applyLang(next);
        });
      });
    })();

    // ——— Меню-гамбургер + підсвітка активної сторінки ———
    (function(){
      document.addEventListener('DOMContentLoaded', function(){
        const menuBtn = document.querySelector('.menu-toggle');
        const nav = document.getElementById('primary-nav');
        if (menuBtn && nav){
          menuBtn.addEventListener('click', function(e){
            e.preventDefault();
            const opened = nav.classList.toggle('active');
            menuBtn.setAttribute('aria-expanded', String(opened));
            menuBtn.textContent = opened ? '✕' : '☰';
          });

          const current = window.location.pathname.split('/').pop() || 'map-awareness-test-v2.html';
          nav.querySelectorAll('a').forEach(a => {
            if (a.getAttribute('href') === current){
              a.classList.add('active');
              a.setAttribute('aria-current', 'page');
            }
          });
        }
      });
    })();

    // ——— Дані рівнів та питань (UA / EN) ———
    const LEVELS_UK = {
      1:{name:"Інстинктивний", key:'instinct', desc:"Реакція важливіша за роздуми. Головне — вижити й не морочити голову."},
      2:{name:"Емоційно-соціальний", key:'emosoc', desc:"Бути як усі. Оцінка інших — компас. Рішення народжуються зі звички і настрою."},
      3:{name:"Раціональний/егоцентричний", key:'rational', desc:"Логіка, користь, цілі. Віра у контроль і вибір. Працює, але має стелю."},
      4:{name:"Критичний/саморефлексивний", key:'critical', desc:"Сумнів у власних переконаннях. Бачиш суперечності, вчишся дивитись на себе збоку."},
      5:{name:"Екзистенційний", key:'existential', desc:"Порожнеча й глибина разом. Дія без гарантій, чесність дорожча за комфорт."},
      6:{name:"Системний/метасвідомість", key:'systemic', desc:"Ти частина процесу. Менше боротьби, більше узгодженості з реальністю."},
      7:{name:"Тотальна присутність", key:'total', desc:"Немає того, хто все контролює. Є спокійна очевидність того, що відбувається."}
    };

    const LEVELS_EN = {
      1:{name:"Instinctive", key:'instinct', desc:"Reaction is more important than thinking. The main thing is to survive and not overthink."},
      2:{name:"Emotional / social", key:'emosoc', desc:"To be like everyone else. Others’ opinion is the compass. Decisions are born from habit and mood."},
      3:{name:"Rational / ego-centric", key:'rational', desc:"Logic, benefit, goals. Faith in control and choice. Works, but has a ceiling."},
      4:{name:"Critical / self-reflective", key:'critical', desc:"Doubt in your own beliefs. You see contradictions and learn to look at yourself from the side."},
      5:{name:"Existential", key:'existential', desc:"Emptiness and depth together. Action without guarantees, honesty is more valuable than comfort."},
      6:{name:"Systemic / meta-awareness", key:'systemic', desc:"You are part of the process. Less struggle, more alignment with reality."},
      7:{name:"Total presence", key:'total', desc:"There is no one who controls everything. There is a calm obviousness of what is happening."}
    };

    const QUESTIONS_UK = [
      {t:'Ранок. Перша думка?', o:[['Треба встати.',1],['Спостерігаю стан, встаю без історій.',6],['Що мене чекає?',3],['Ще 5 хв…',2]]},
      {t:'Коли план зривається…', o:[['Злюсь, бо не по моєму.',1],['Шукаю винних/причини.',3],['Коригую курс і йду далі.',6],['Сміюся з абсурду, не чіпляюсь.',5]]},
      {t:'Як обираєш між “цікаво” і “потрібно”?', o:[['Роблю потрібне, бурчу.',2],['Вибираю цікаве і кидаю інше.',3],['Роблю потрібне спокійно; цікаве — коли є ресурс.',6],['Це одна і та сама дія в різних фазах.',7]]},
      {t:'Суперечки з близькими.', o:[['Доводжу свою правоту.',1],['Пояснюю логікою, хочу, щоб зрозуміли.',4],['Слухаю і знімаю напругу, залишаю суть.',6],['Усміхаюсь: кожен бачить свій світ.',5]]},
      {t:'Смерть — це…', o:[['Кінець і темрява.',1],['Таємниця, яка лякає.',2],['Природний етап процесу.',6],['Зміна форми присутності.',7]]},
      {t:'Про сенс життя.', o:[['Створити сім’ю/кар’єру.',2],['Знайти “своє покликання”.',3],['Життя є. Роблю, що робиться.',6],['Питання зникає як непотрібне.',7]]},
      {t:'Коли хтось бреше впевнено…', o:[['Злюсь і йду в конфлікт.',1],['Пояснюю, де логічна дірка.',4],['Спокійно фіксую: це їхня стратегія.',6],['Це система страху, жаліти нема кого.',5]]},
      {t:'Тіло і біль.', o:[['Тікаю від болю, ігнорую.',1],['Шукаю швидке полегшення.',2],['Слухаю сигнал, коригую режим.',4],['Біль — частина процесу. Ні драм, ні героїзму.',6]]},
      {t:'Віра в “вищий план”.', o:[['Так, Бог керує.',2],['Мабуть щось є…',3],['Є процес без автора.',6],['Це просто слова для страху.',5]]},
      {t:'Про майбутнє.', o:[['Тривожно думаю, що буде.',2],['Планую детально.',4],['Готуюсь розумно й відпускаю.',6],['Майбутнього нема — є дія зараз.',7]]},

      {t:'Помилка на роботі.', o:[['Ховаю/виправдовуюсь.',1],['Довожу, що не я.',2],['Фіксую причину, змінюю процес.',4],['Помилка — нормальний шум системи.',6]]},
      {t:'Гроші для тебе — це…', o:[['Безпека.',2],['Свобода вибору.',3],['Інструмент.',4],['Паливо процесу, не мета.',6]]},
      {t:'Про любов.', o:[['Моя половинка.',2],['Робота над стосунками.',3],['Щоденна дія без торгу.',6],['Присутність без власника.',7]]},
      {t:'Коли хтось тисне авторитетом.', o:[['Підкоряюсь.',1],['Опротивляюсь.',2],['Запитую про механізм.',4],['Ігнорую роль, бачу людину/функцію.',6]]},
      {t:'Час і дати.', o:[['Святе, тримаюсь традицій.',2],['Ціную ритуал/спільність.',3],['Користуюсь, але не поклоняюсь.',5],['Є лише фази процесу.',7]]},
      {t:'Коли все валиться.', o:[['Паніка.',1],['Молюся/сподіваюсь.',2],['Роблю мінімально необхідне.',6],['Дивлюсь, що саме помирає — і дозволяю.',5]]},
      {t:'Чужий успіх.', o:[['Заздрю.',1],['Мотивуюсь.',3],['Беру принцип і йду далі.',4],['Ні холодно, ні жарко.',6]]},
      {t:'Про свободу волі.', o:[['Я вирішую все.',2],['Є і свобода, і доля.',3],['Вибору немає, є реакції системи.',6],['Питання не має сенсу.',7]]},
      {t:'Релігія.', o:[['Шлях до спасіння.',2],['Джерело моралі.',3],['Інструмент контролю/утіхи.',5],['Не потрібна для бачення реальності.',6]]},
      {t:'Коли тебе хвалять.', o:[['Хочу ще.',1],['Ніяково, але приємно.',2],['Фіксую факт, не чіпляюсь.',6],['Порожній звук.',7]]},

      {t:'Ті, хто просять “впевненості” від системи.', o:[['Потрібно людям — і добре.',3],['Нехай, всі різні.',4],['Це страх сумніву, ок.',6],['Нехай сплять, не буджу.',5]]},
      {t:'Про дітей.', o:[['Треба зробити щасливими.',2],['Навчити правил/цінностей.',3],['Дати реальність без брехні.',6],['Не чіпляти ярлики, бути поруч.',5]]},
      {t:'Про роботу.', o:[['Заробляти максимум.',2],['Самореалізація.',3],['Роблю якісно те, що треба.',6],['Це просто функція, не ідентичність.',5]]},
      {t:'Емоції.', o:[['Керують мною.',1],['Контролюю як можу.',2],['Спостерігаю хвилю, не тону.',6],['Все — хвиля. Спокій у фоні.',7]]},
      {t:'Сміття в голові.', o:[['Телефон/серіал і спать.',1],['Книга/подкаст.',3],['Фізична дія, сон, тиша.',6],['Нічого не роблю — шум проходить сам.',7]]},
      {t:'Коли просять “поясни смисл”.', o:[['Да-да, зараз вигадую.',3],['Кажу чесно: немає смислу.',6],['Не бачу користі від питання.',7],['Повертаю до фактів їхнього дня.',5]]},
      {t:'Про тіло.', o:[['Тренд/фітнес/дієта.',2],['Дисципліна і план.',3],['Слухати сигнали і рухатись простими кроками.',4],['Тіло — не я. Дбаю без культу.',6]]},
      {t:'Про чужий біль.', o:[['Важко це витримати.',2],['Підтримую словами.',3],['Поруч дією/тишею.',6],['Не рятую, не тягну — не моя гра.',5]]},
      {t:'Про “себе”.', o:[['Я — характер, історія.',2],['Я — той, хто вибирає.',3],['Я — камера, що бачить.',6],['Я — відсутнє. Є лише бачення.',7]]},
      {t:'Коли тебе провокують.', o:[['Вибухаю.',1],['Тримаюсь, але киплю.',2],['Фіксую намір, не підхоплюю.',6],['Посміхаюсь: це їхній танець.',5]]},

      {t:'План на день.', o:[['Щоб усе встигнути.',2],['Щоб рухатись до цілей.',3],['Щоб в порядку був світ біля мене.',4],['Є те, що треба зробити — і роблю.',6]]},
      {t:'Про владу/системи.', o:[['Потрібні для порядку.',2],['Зло/добро залежно від людей.',3],['Механізм контролю/страху.',5],['Користуюсь, не поклоняюсь.',6]]},
      {t:'Про природу.', o:[['Місце для відпочинку.',2],['Джерело сили/натхнення.',3],['Цикл, до якого я належу.',6],['Я і є природа, без “я”.',7]]},
      {t:'Коли нема сил.', o:[['Тисну себе.',1],['Шукаю мотивацію.',3],['Роблю мінімум і сплю.',6],['Нічого. Нехай система відновиться.',7]]},
      {t:'Коли система бреше впевнено.', o:[['Ненавиджу.',1],['Викриваю прилюдно.',4],['Не даю себе обманути, іду далі.',6],['Це їхня гра з масою, я поза.',5]]},
      {t:'Чому не всім “заходить” правда.', o:[['Бо дурні.',1],['Не вміють думати.',3],['Бо боляче, є захист психіки.',6],['Їм це не потрібно — їхній шлях інший.',5]]},
      {t:'Що тебе рухає частіше?', o:[['Страх.',1],['Бажання.',2],['Практична необхідність.',6],['Цікавість без мети.',5]]},
      {t:'Що для тебе “добро”?', o:[['Робити, як вчать.',2],['Бути корисним.',3],['Не брехати собі.',6],['Не чіплятися за ярлики.',7]]},
      {t:'Як ти ставишся до мату?', o:[['Погано. Негоже.',2],['Можна, але рідко.',3],['Це інструмент інтонації.',6],['Це шум слова, не суть.',7]]},
      {t:'Що ти робиш із “сенсом життя”?', o:[['Шукаю.',3],['Вигадую свій.',4],['Не шукаю — просто живу.',6],['Це зайве слово.',7]]},
      {t:'Коли бачиш у собі суперечність.', o:[['Ігнорую.',1],['Виправдовую.',2],['Фіксую і виправляю процес.',4],['Не чіпляюсь: суперечність — ознака живого.',6]]},
      {t:'Твоє ставлення до “вищих” станів.', o:[['Хочу туди скоріше.',3],['Це про кращих людей.',4],['Нема куди йти — є бачити.',6],['Самі назви зайві.',7]]},
    ];

    const QUESTIONS_EN = [
      {t:'Morning. First thought?', o:[['I need to get up.',1],['I observe the state and get up without stories.',6],['What is waiting for me today?',3],['Five more minutes…',2]]},
      {t:'When the plan falls apart…', o:[['I get angry because it’s not my way.',1],['I look for someone/something to blame.',3],['I adjust the course and move on.',6],['I laugh at the absurdity and don’t cling.',5]]},
      {t:'How do you choose between “interesting” and “necessary”?', o:[['I do what’s necessary and grumble.',2],['I choose what’s interesting and drop the rest.',3],['I do what’s necessary calmly; the interesting part — when there’s resource.',6],['It’s the same action in different phases.',7]]},
      {t:'Conflicts with close ones.', o:[['I prove I am right.',1],['I explain with logic, I want them to understand.',4],['I listen and defuse tension, keep the essence.',6],['I smile: everyone sees their own world.',5]]},
      {t:'Death is…', o:[['An end and darkness.',1],['A mystery that frightens.',2],['A natural stage of the process.',6],['A change of the form of presence.',7]]},
      {t:'About the meaning of life.', o:[['To build a family/career.',2],['To find “my calling”.',3],['Life is. I do what is done.',6],['The question disappears as unnecessary.',7]]},
      {t:'When someone lies confidently…', o:[['I get angry and go into conflict.',1],['I explain where the logical hole is.',4],['I calmly note: it’s their strategy.',6],['It’s a system of fear, there’s no one to pity.',5]]},
      {t:'Body and pain.', o:[['I run from pain, ignore it.',1],['I look for quick relief.',2],['I listen to the signal and adjust the regime.',4],['Pain is part of the process. No drama, no heroism.',6]]},
      {t:'Belief in a “higher plan”.', o:[['Yes, God is in charge.',2],['Probably something exists…',3],['There is a process without an author.',6],['Just words for fear.',5]]},
      {t:'About the future.', o:[['I anxiously think about what will be.',2],['I plan in detail.',4],['I prepare reasonably and let go.',6],['There is no future — there is action now.',7]]},

      {t:'A mistake at work.', o:[['I hide it / make excuses.',1],['I prove it wasn’t me.',2],['I fix the cause, change the process.',4],['A mistake is normal system noise.',6]]},
      {t:'Money for you is…', o:[['Safety.',2],['Freedom of choice.',3],['A tool.',4],['Fuel of the process, not the goal.',6]]},
      {t:'About love.', o:[['My other half.',2],['Work on the relationship.',3],['Daily action without bargaining.',6],['Presence without an owner.',7]]},
      {t:'When someone pushes with authority.', o:[['I obey.',1],['I resist.',2],['I ask about the mechanism.',4],['I ignore the role, I see the person/function.',6]]},
      {t:'Time and dates.', o:[['Sacred, I stick to traditions.',2],['I value ritual / togetherness.',3],['I use them but don’t worship.',5],['There are only phases of a process.',7]]},
      {t:'When everything collapses.', o:[['Panic.',1],['I pray / hope.',2],['I do the minimum necessary.',6],['I watch what exactly is dying — and allow it.',5]]},
      {t:'Someone else’s success.', o:[['I envy.',1],['It motivates me.',3],['I take the principle and move on.',4],['Neither cold nor hot for me.',6]]},
      {t:'About free will.', o:[['I decide everything.',2],['There is both freedom and fate.',3],['There is no choice, only system reactions.',6],['The question doesn’t make sense.',7]]},
      {t:'Religion.', o:[['A path to salvation.',2],['A source of morality.',3],['A tool of control / comfort.',5],['Not needed to see reality.',6]]},
      {t:'When you’re praised.', o:[['I want more.',1],['It’s awkward but pleasant.',2],['I note the fact and don’t cling.',6],['Empty sound.',7]]},

      {t:'Those who ask “for confidence” from the system.', o:[['People need it — and that’s fine.',3],['Let it be, everyone is different.',4],['It’s fear of doubt, okay.',6],['Let them sleep, I don’t wake them up.',5]]},
      {t:'About children.', o:[['I must make them happy.',2],['Teach them rules/values.',3],['Give them reality without lies.',6],['No labels, just being next to them.',5]]},
      {t:'About work.', o:[['To earn as much as possible.',2],['Self-realization.',3],['I do well what needs to be done.',6],['It’s just a function, not identity.',5]]},
      {t:'Emotions.', o:[['They control me.',1],['I control them as I can.',2],['I watch the wave but don’t drown.',6],['Everything is a wave. Calm is in the background.',7]]},
      {t:'Trash in the head.', o:[['Phone / series and to bed.',1],['A book / podcast.',3],['Physical action, sleep, silence.',6],['I do nothing — the noise passes by itself.',7]]},
      {t:'When someone asks “explain the meaning”.', o:[['Yeah-yeah, I’ll invent something now.',3],['I honestly say: there is no meaning.',6],['I see no use in this question.',7],['I bring them back to the facts of their day.',5]]},
      {t:'About the body.', o:[['Trend/fitness/diet.',2],['Discipline and plan.',3],['Listen to signals and move in simple steps.',4],['The body is not me. I care without cult.',6]]},
      {t:'About someone else’s pain.', o:[['It’s hard to bear it.',2],['I support with words.',3],['I stay by action / silence.',6],['I don’t save or drag — not my game.',5]]},
      {t:'About “self”.', o:[['I am character and story.',2],['I am the one who chooses.',3],['I am the camera that sees.',6],['I am absent. There is only seeing.',7]]},
      {t:'When someone provokes you.', o:[['I explode.',1],['I hold it in but boil inside.',2],['I see the intent and don’t pick it up.',6],['I smile: it’s their dance.',5]]},

      {t:'Plan for the day.', o:[['To get everything done.',2],['To move towards goals.',3],['To keep the world around me in order.',4],['There is what needs to be done — and I do it.',6]]},
      {t:'About power / systems.', o:[['Necessary for order.',2],['Good/evil depending on people.',3],['Mechanism of control/fear.',5],['I use them, I don’t worship.',6]]},
      {t:'About nature.', o:[['A place to rest.',2],['Source of strength/inspiration.',3],['A cycle I belong to.',6],['I am nature as well, without “I”.',7]]},
      {t:'When there is no energy.', o:[['I push myself.',1],['I look for motivation.',3],['I do the minimum and sleep.',6],['Nothing. Let the system recover.',7]]},
      {t:'When the system lies confidently.', o:[['I hate it.',1],['I expose it publicly.',4],['I don’t let it fool me and move on.',6],['It’s their game with the mass, I’m outside.',5]]},
      {t:'Why doesn’t the truth “land” for everyone?', o:[['Because they’re stupid.',1],['They can’t think.',3],['Because it’s painful, the psyche protects.',6],['They don’t need it — their path is different.',5]]},
      {t:'What drives you more often?', o:[['Fear.',1],['Desire.',2],['Practical necessity.',6],['Curiosity without a goal.',5]]},
      {t:'What is “good” for you?', o:[['To do as taught.',2],['To be useful.',3],['Not to lie to yourself.',6],['Not to cling to labels.',7]]},
      {t:'How do you feel about swearing?', o:[['Bad. Not decent.',2],['Okay, but rarely.',3],['It’s a tool of intonation.',6],['It’s word noise, not essence.',7]]},
      {t:'What do you do with the “meaning of life”?', o:[['I search for it.',3],['I invent my own.',4],['I don’t search — I simply live.',6],['It’s an extra word.',7]]},
      {t:'When you see a contradiction in yourself.', o:[['I ignore it.',1],['I justify it.',2],['I note it and fix the process.',4],['I don’t cling: contradiction is a sign of the living.',6]]},
      {t:'Your attitude to “higher” states.', o:[['I want to get there faster.',3],['It’s about better people.',4],['There is nowhere to go — only to see.',6],['Even the names are unnecessary.',7]]},
    ];

    // ——— Візуалізація спіралі ———
    function polar(cx, cy, r, a){ return [cx + r * Math.cos(a), cy + r * Math.sin(a)]; }
    function arcPath(cx, cy, r, a0, a1){
      const p0 = polar(cx,cy,r,a0);
      const p1 = polar(cx,cy,r,a1);
      const x0 = p0[0], y0 = p0[1], x1 = p1[0], y1 = p1[1];
      const large = ((a1-a0)%(Math.PI*2)>Math.PI)?1:0;
      return 'M '+x0.toFixed(2)+' '+y0.toFixed(2)+' A '+r+' '+r+' 0 '+large+' 1 '+x1.toFixed(2)+' '+y1.toFixed(2);
    }
    function drawRings(){
      const cx=160, cy=160, baseR=40, gap=16, a0=-Math.PI*0.75, sweep=Math.PI*1.5;
      for(let lvl=1; lvl<=7; lvl++){
        const g=document.getElementById('ring'+lvl);
        if(!g) continue;
        g.innerHTML='';
        const r=baseR+(lvl-1)*gap;
        const p=document.createElementNS('http://www.w3.org/2000/svg','path');
        p.setAttribute('d', arcPath(cx,cy,r,a0,a0+sweep));
        g.appendChild(p);
        const tx=document.createElementNS('http://www.w3.org/2000/svg','text');
        const pos = polar(cx,cy,r,a0-0.1);
        const lx = pos[0], ly = pos[1];
        tx.setAttribute('x', lx);
        tx.setAttribute('y', ly);
        tx.textContent = String(lvl);
        g.appendChild(tx);
      }
    }
    function activateLevel(lvl){
      for(let i=1;i<=7;i++){
        const g=document.getElementById('ring'+i);
        if(!g) continue;
        const path=g.querySelector('path');
        if(!path) continue;
        if(i===lvl){
          path.classList.add('active','pulse');
        } else {
          path.classList.remove('active','pulse');
        }
      }
    }
    drawRings();

    // ——— Стейт тесту ———
    let currentLang = localStorage.getItem('lang') || 'uk';
    let LEVELS = (currentLang === 'en') ? LEVELS_EN : LEVELS_UK;
    let QUESTIONS = (currentLang === 'en') ? QUESTIONS_EN : QUESTIONS_UK;

    let idx=0;
    const picks=[];
    const counts={1:0,2:0,3:0,4:0,5:0,6:0,7:0};
    let lastResult = null;

    const qText=document.getElementById('qText');
    const optsDiv=document.getElementById('opts');
    const btnNext=document.getElementById('btnNext');
    const bar=document.getElementById('bar');
    const btnQuit=document.getElementById('btnQuit');
    const hintSpan=document.getElementById('hint');

    const resPanel=document.getElementById('resultPanel');
    const resSummary=document.getElementById('resSummary');
    const resBadges=document.getElementById('resBadges');
    const vizEcho=document.getElementById('vizEcho');
    const resDetails=document.getElementById('resDetails');
    const btnRetake=document.getElementById('btnRetake');
    const btnShare=document.getElementById('btnShare');

    function uiText(key){
      const uk = {
        hint: 'Обери варіант, щоб перейти далі.',
        next: 'Далі',
        legendStart: 'Почнемо.',
        mark: 'Твоя позначка',
        total: 'Всього',
        consistencyHigh: 'висока',
        consistencyMidLow: 'середня/низька',
        consistencyLabel: 'Узгодженість',
        shareCopied: 'Посилання скопійовано',
        share: 'Поділитися'
      };
      const en = {
        hint: 'Choose an option to move on.',
        next: 'Next',
        legendStart: 'Let’s start.',
        mark: 'Your mark',
        total: 'Total',
        consistencyHigh: 'high',
        consistencyMidLow: 'medium/low',
        consistencyLabel: 'Consistency',
        shareCopied: 'Link copied',
        share: 'Share'
      };
      return (currentLang === 'en' ? en : uk)[key];
    }

    function renderStep(){
      const q=QUESTIONS[idx];
      if(!q) return;
      qText.textContent=(idx+1)+'. '+q.t;
      optsDiv.innerHTML='';
      btnNext.disabled=true;
      q.o.forEach(function(item,oi){
        const label = item[0];
        const lvl = item[1];
        const id='q'+idx+'_o'+oi;
        const lab=document.createElement('label');
        lab.className='opt';
        const input=document.createElement('input');
        input.type='radio';
        input.name='cur';
        input.value=String(lvl);
        input.id=id;
        input.addEventListener('change',function(){btnNext.disabled=false;});
        const span=document.createElement('span');
        span.textContent=label;
        lab.appendChild(input);
        lab.appendChild(span);
        optsDiv.appendChild(lab);
      });
      bar.style.width=String(Math.round(idx*100/QUESTIONS.length))+'%';
      hintSpan.textContent = uiText('hint');
      btnNext.textContent = uiText('next');
      // блокування повернення назад: просто оновлюємо state URL
      if (window.history && window.history.replaceState){
        window.history.replaceState(null, '', window.location.pathname);
      }
    }

    function next(){
      const sel=document.querySelector('input[name="cur"]:checked');
      if(!sel) return;
      const v=Number(sel.value);
      picks.push(v);
      if (counts.hasOwnProperty(v)){ counts[v]++; }
      idx++;
      if(idx<QUESTIONS.length){
        renderStep();
      } else {
        finish();
      }
    }

    if(btnNext){
      btnNext.addEventListener('click', next);
    }
    if(btnQuit){
      btnQuit.addEventListener('click', function(){ location.reload(); });
    }

    function compute(){
      const total=picks.length;
      const arr=Object.keys(counts).map(function(k){
        return {lvl:Number(k), n:counts[k]};
      });
      arr.sort(function(a,b){
        if (b.n !== a.n) return b.n - a.n;
        return b.lvl - a.lvl;
      });
      const top=arr[0];
      const second=arr[1];
      const spread=top.n-second.n;
      const hi=counts[6]+counts[7];
      const mid=counts[4]+counts[5];
      const borrowed=(hi>=Math.ceil(total*0.5) && mid < Math.ceil(total*0.2));
      return {counts:counts, totalAnswered: total, top:top, second:second, spread:spread, borrowed:borrowed};
    }

    function pct(n,total){
      return total ? Math.round(n*100/total) : 0;
    }

    function renderResult(R){
      lastResult = R;
      var L=LEVELS[R.top.lvl];
      activateLevel(R.top.lvl);

      if(currentLang === 'en'){
        resSummary.innerHTML = uiText('mark') + ': <strong>'+R.top.lvl+'. '+L.name+'</strong>. '+L.desc;
      } else {
        resSummary.innerHTML = uiText('mark') + ': <strong>'+R.top.lvl+'. '+L.name+'</strong>. '+L.desc;
      }

      var consistencyWord = (R.spread>=3 ? uiText('consistencyHigh') : uiText('consistencyMidLow'));
      resBadges.innerHTML =
        '<span class="pill">'+uiText('total')+': '+R.totalAnswered+'/42</span>'+
        '<span class="pill">'+R.top.lvl+': '+R.top.n+' ('+pct(R.top.n,R.totalAnswered)+'%)</span>'+
        '<span class="pill">'+R.second.lvl+': '+R.second.n+' ('+pct(R.second.n,R.totalAnswered)+'%)</span>'+
        '<span class="pill">'+uiText('consistencyLabel')+': '+consistencyWord+'</span>'+
        (R.borrowed ? (currentLang === 'en'
          ? ' <span class="pill" style="background:#fff3cd">Borrowed depth?</span>'
          : ' <span class="pill" style="background:#fff3cd">Позичена глибина?</span>'
        ) : '');

      // невеликий дублікат спіралі
      var mainViz = document.querySelector('.viz');
      if(mainViz){
        vizEcho.innerHTML = mainViz.innerHTML;
      }

      var lines=[];
      for(var lvl=1; lvl<=7; lvl++){
        var c=R.counts[lvl];
        var meta=LEVELS[lvl];
        var tag='';
        if(lvl===R.top.lvl){ tag = (currentLang === 'en' ? ' (leading)' : ' (провідний)'); }
        else if(lvl===R.second.lvl){ tag = (currentLang === 'en' ? ' (second)' : ' (другий)'); }
        lines.push(
          '<p><strong>'+lvl+'. '+meta.name+tag+'</strong>: '+c+' — '+pct(c,R.totalAnswered)+'%. <em>'+meta.desc+'</em></p>'
        );
      }

      if(R.borrowed){
        if(currentLang === 'en'){
          lines.push(
            '<div class="danger"><strong>Warning: “borrowed depth”.</strong> Many answers at levels 6–7 with tiny 4–5. Check if there are simple, non-heroic actions in your days (sleep, food, cleaning, physical work). If not — it’s reading, not seeing.</div>'
          );
        } else {
          lines.push(
            '<div class="danger"><strong>Попередження: “позичена глибина”.</strong> Багато відповідей на 6–7 рівнях при мізерних 4–5. Перевір, чи є в дні прості дії без пафосу (сон, їжа, прибирання, фізична робота). Якщо ні — це читання, а не бачення.</div>'
          );
        }
      }

      resDetails.innerHTML = lines.join('');

      if(btnShare){
        btnShare.hidden=false;
        // оновлюємо текст кнопки під мову
        var shareLabel = (currentLang === 'en' ? 'Share' : 'Поділитися');
        btnShare.querySelector('.lang-en') && (btnShare.querySelector('.lang-en').hidden = (currentLang!=='en'));
        btnShare.querySelector('.lang-uk') && (btnShare.querySelector('.lang-uk').hidden = (currentLang==='en'));
        btnShare.addEventListener('click', function(){
          var payload={counts:R.counts, top:R.top, second:R.second, t:Date.now()};
          var s = encodeURIComponent(btoa(JSON.stringify(payload)));
          var url = window.location.origin + window.location.pathname + '?r=' + s;
          if (navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(url).then(function(){
              btnShare.textContent = uiText('shareCopied');
              setTimeout(function(){
                btnShare.textContent = uiText('share');
              },1200);
            }).catch(function(){
              alert(url);
            });
          } else {
            alert(url);
          }
        }, { once:true });
      }
    }

    function finish(){
      var stepPanel=document.getElementById('stepPanel');
      stepPanel.hidden=true;
      resPanel.hidden=false;
      bar.style.width='100%';
      btnQuit.hidden=false;
      var R=compute();
      renderResult(R);
      try{
        localStorage.setItem('thinking_v2_result_step', JSON.stringify(R));
      }catch(e){}
      window.scrollTo({top:0, behavior:'smooth'});
    }

    if(btnRetake){
      btnRetake.addEventListener('click', function(){ location.reload(); });
    }

    // запуск
    qText.textContent = uiText('legendStart');
    renderStep();

    // ——— Відновлення по шарингу (тільки результат) ———
    (function(){
      var u = new URL(window.location.href);
      var r = u.searchParams.get('r');
      if(!r) return;
      try{
        var obj = JSON.parse(atob(decodeURIComponent(r)));
        var countsRestored = obj.counts || {};
        // заміна внутрішнього counts
        for(var k in counts){
          if(countsRestored.hasOwnProperty(k)){
            counts[k] = countsRestored[k];
          }
        }
        var total = Object.values(counts).reduce(function(a,b){return a+b;},0);
        var top = obj.top;
        var second = obj.second;
        var R = {
          counts: counts,
          top: top,
          second: second,
          totalAnswered: total,
          spread: top.n - second.n,
          borrowed: false
        };
        var stepPanel=document.getElementById('stepPanel');
        stepPanel.hidden=true;
        resPanel.hidden=false;
        drawRings();
        activateLevel(R.top.lvl);
        renderResult(R);
        btnQuit.hidden=false;
      }catch(e){}
    })();

    // ——— Реакція тесту на зміну мови ———
    window.__onLangChange = function(lang){
      currentLang = (lang === 'en' ? 'en' : 'uk');
      LEVELS = (currentLang === 'en') ? LEVELS_EN : LEVELS_UK;
      QUESTIONS = (currentLang === 'en') ? QUESTIONS_EN : QUESTIONS_UK;

      if (document.getElementById('stepPanel').hidden){
        // показано результат
        if(lastResult){
          renderResult(lastResult);
        }
      } else {
        // іде тест — просто перемалювати поточне питання
        renderStep();
      }
    };
  </script>
</body>
</html>
